<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="clr-namespace:OCC.Client.ViewModels.Time"
			 mc:Ignorable="d" d:DesignWidth="1024" d:DesignHeight="768"
			 x:Class="OCC.Client.Views.Time.AttendanceHistoryView"
			 x:DataType="vm:AttendanceHistoryViewModel"
			 x:Name="Root">

	<Design.DataContext>
		<vm:AttendanceHistoryViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto, Auto, *">
		<!-- Header Bar: Title & Actions -->
		<Border Grid.Row="0" Padding="10" Background="{DynamicResource WeatheredCementGradient}">
			<Grid ColumnDefinitions="*, Auto">
				<TextBlock Text="Attendance History" FontSize="24" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryDark}"/>

				<!-- Actions -->
				<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
					<Button Command="{Binding BulkEditCommand}" Classes="Primary" ToolTip.Tip="Bulk Edit Selected">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<PathIcon Data="{StaticResource IconEdit}" Width="16" Height="16"/>
							<TextBlock Text="Bulk Edit" VerticalAlignment="Center"/>
						</StackPanel>
					</Button>
					
					<Button Command="{Binding PrintReportCommand}" Classes="Secondary" ToolTip.Tip="Print Report">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<PathIcon Data="{StaticResource IconPrint}" Width="16" Height="16"/>
							<TextBlock Text="Print" VerticalAlignment="Center"/>
						</StackPanel>
					</Button>
					<Button Command="{Binding ExportCsvCommand}" Classes="Secondary" ToolTip.Tip="Export CSV" Padding="10,8">
						<PathIcon Data="{StaticResource IconDownload}" Width="16" Height="16"/>
					</Button>
					<Button Command="{Binding RefreshCommand}" Classes="Secondary" ToolTip.Tip="Refresh" Padding="10,8">
						<PathIcon Data="{StaticResource IconHistory}" Width="16" Height="16"/>
					</Button>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Toolbar Bar: Filters & Summary Stats -->
		<Border Grid.Row="1" Padding="10,5" Background="{DynamicResource WeatheredCementGradient}" Margin="0,0,0,5">
			<Grid ColumnDefinitions="Auto, *, Auto">
				<!-- Filters -->
				<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
					<ComboBox ItemsSource="{Binding RangeOptions}" SelectedItem="{Binding SelectedRange}"
							  Width="140" Classes="FormInput" VerticalAlignment="Center" PlaceholderText="Range"/>

					<ComboBox ItemsSource="{Binding BranchOptions}" SelectedItem="{Binding SelectedBranch}"
							  Width="140" Classes="FormInput" VerticalAlignment="Center" PlaceholderText="Branch"/>

					<ComboBox ItemsSource="{Binding PayTypeOptions}" SelectedItem="{Binding SelectedPayType}"
							  Width="110" Classes="FormInput" VerticalAlignment="Center" PlaceholderText="Pay Type"/>
					
					<StackPanel Orientation="Horizontal" Spacing="5" IsVisible="{Binding IsCustomDateEnabled}">
						<DatePicker SelectedDate="{Binding StartDate}" VerticalAlignment="Center"/>
						<TextBlock Text="-" VerticalAlignment="Center"/>
						<DatePicker SelectedDate="{Binding EndDate}" VerticalAlignment="Center"/>
					</StackPanel>
				</StackPanel>

				<!-- Summary Cards -->
				<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
					<Border Classes="Card" Padding="10,3" Width="130">
						<StackPanel>
							<TextBlock Text="Total Hours" Classes="LabelText" HorizontalAlignment="Center" FontSize="10"/>
							<TextBlock Text="{Binding TotalHours, StringFormat='{}{0:F2}'}" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource PrimaryBlue}" HorizontalAlignment="Center"/>
						</StackPanel>
					</Border>
					<Border Classes="Card" Padding="10,3" Width="130" Background="#E8F5E9" BorderBrush="#81C784"
							IsVisible="{Binding IsWageVisible}">
						<StackPanel>
							<TextBlock Text="Est. Wages" Classes="LabelText" HorizontalAlignment="Center" FontSize="10" Foreground="#388E3C"/>
							<TextBlock Text="{Binding TotalWages, StringFormat='{}{0:C}'}" FontSize="14" FontWeight="Bold" Foreground="#2E7D32" HorizontalAlignment="Center"/>
						</StackPanel>
					</Border>
				</StackPanel>
			</Grid>
		</Border>

		<!-- DataGrid -->
		<DataGrid Grid.Row="2" ItemsSource="{Binding Records}" AutoGenerateColumns="False"
				  IsReadOnly="True" GridLinesVisibility="Horizontal"
				  BorderThickness="0,1,0,0" BorderBrush="{DynamicResource BorderGray}"
				  Background="White" RowBackground="White">
            <DataGrid.Styles>
                <Style Selector="DataGridRow">
                    <Setter Property="ContextMenu">
                        <ContextMenu>
                            <MenuItem Header="Edit Time" 
                                      Command="{Binding #Root.DataContext.EditRecordCommand}" 
                                      CommandParameter="{Binding}">
                                <MenuItem.Icon>
                                    <PathIcon Data="{StaticResource IconEdit}" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator/>
                            <MenuItem Header="Delete Record"
                                      Command="{Binding #Root.DataContext.DeleteRecordCommand}"
                                      CommandParameter="{Binding}"
                                      Foreground="Red">
                                <MenuItem.Icon>
                                    <PathIcon Data="{StaticResource IconDelete}" Foreground="Red"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </Setter>
                </Style>
            </DataGrid.Styles>
			<DataGrid.Columns>
				<DataGridTemplateColumn Width="40">
					<DataGridTemplateColumn.Header>
						<CheckBox IsChecked="{Binding #Root.DataContext.IsAllSelected}"/>
					</DataGridTemplateColumn.Header>
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<CheckBox IsChecked="{Binding IsSelected}" HorizontalAlignment="Center"/>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
				
				<DataGridTextColumn Header="Date" Binding="{Binding Date, StringFormat='{}{0:dd MMM yyyy}'}" Width="Auto"/>
				<DataGridTextColumn Header="Employee" Binding="{Binding EmployeeName}" Width="*" MinWidth="250"/>
				<DataGridTextColumn Header="Branch" Binding="{Binding Branch}" Width="Auto"/>
				<DataGridTextColumn Header="Pay Type" Binding="{Binding PayType}" Width="Auto"/>
				<DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="Auto"/>
				<DataGridTextColumn Header="In" Binding="{Binding InTime}" Width="Auto"/>
				<DataGridTextColumn Header="Out" Binding="{Binding OutTime}" Width="Auto"/>
				<DataGridTextColumn Header="Hours" Binding="{Binding HoursWorkedDisplay}" Width="Auto"/>
				<!-- Wage Column Hidden via Binding -->
				<DataGridTextColumn Header="Wage (Est.)" Binding="{Binding WageDisplay}" Width="Auto"
									Foreground="#2E7D32" FontWeight="Bold"
									IsVisible="{Binding #Root.DataContext.IsWageVisible}"/>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Loading -->
		<StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding IsBusy}">
			<ProgressBar IsIndeterminate="True" Width="200" Foreground="{DynamicResource OCCOrange}"/>
			<TextBlock Text="Loading Attendance Records..." HorizontalAlignment="Center" Margin="0,10,0,0" Classes="LabelSmall"/>
		</StackPanel>

		<!-- Empty State -->
		<StackPanel Grid.Row="2" HorizontalAlignment="Center" VerticalAlignment="Center"
					IsVisible="{Binding !Records.Count}">
			<PathIcon Data="{StaticResource IconHistory}" Width="48" Height="48" Foreground="{DynamicResource TextTertiarySlate}"
					  IsVisible="{Binding !IsBusy}"/>
			<TextBlock Text="No records found for this period." Margin="0,10,0,0" Foreground="{DynamicResource TextTertiarySlate}"
					   IsVisible="{Binding !IsBusy}"/>
		</StackPanel>
	</Grid>
</UserControl>
