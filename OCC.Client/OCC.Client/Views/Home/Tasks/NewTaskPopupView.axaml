<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.Home.Tasks"
             mc:Ignorable="d"
             x:Class="OCC.Client.Views.Home.Tasks.NewTaskPopupView"
             x:DataType="vm:NewTaskPopupViewModel"
             xmlns:conv="clr-namespace:OCC.Client.Converters">
    
    <UserControl.Resources>
        <conv:NameToInitialsConverter x:Key="NameToInitialsConverter"/>
    </UserControl.Resources>
    
    <Border Background="#F1F5F9" CornerRadius="8" BoxShadow="0 4 20 0 #40000000" Width="500" Padding="0">
        <Grid RowDefinitions="Auto, *, Auto">
            <!-- Header -->
            <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="20,20,20,10">
                <TextBlock Text="New Task" FontSize="20" FontWeight="SemiBold" Foreground="#1E293B"/>
                <Button Grid.Column="1" Command="{Binding CloseCommand}" Classes="IconOnlyButton" HorizontalAlignment="Right">
                    <PathIcon Data="{StaticResource window_close_regular}" Width="12" Height="12" Foreground="#64748B"/>
                </Button>
            </Grid>

            <!-- Content -->
            <StackPanel Grid.Row="1" Margin="20,0">
                <!-- Name Input -->
                <TextBlock Text="NAME" Classes="InputLabel" Margin="0,10,0,5" Foreground="#64748B" FontSize="11" FontWeight="SemiBold"/>
                <TextBox Text="{Binding TaskName}" Watermark="Task name" Classes="StandardTextBox" Background="White" BorderBrush="#E2E8F0"/>

                <!-- Assigned To -->
                <TextBlock Text="ASSIGNED TO" Classes="InputLabel" Margin="0,20,0,5" Foreground="#64748B" FontSize="11" FontWeight="SemiBold"/>
                <ComboBox ItemsSource="{Binding Users}" SelectedItem="{Binding AssignedUser}" 
                          HorizontalAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Border Width="32" Height="32" CornerRadius="16" Background="#00C4B4">
                                    <TextBlock Text="{Binding DisplayName, Converter={StaticResource NameToInitialsConverter}}" 
                                               VerticalAlignment="Center" HorizontalAlignment="Center" 
                                               Foreground="White" FontWeight="Bold" FontSize="12"/>
                                </Border>
                                <TextBlock Text="{Binding Email}" VerticalAlignment="Center" Foreground="#1E293B"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Add to Project -->
                <TextBlock Text="ADD TO PROJECT" Classes="InputLabel" Margin="0,20,0,5" Foreground="#64748B" FontSize="11" FontWeight="SemiBold"/>
                <ComboBox ItemsSource="{Binding Projects}" SelectedItem="{Binding SelectedProject}" 
                          HorizontalAlignment="Stretch" PlaceholderText="None" Classes="StandardComboBox">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </StackPanel>

            <!-- Footer Action -->
            <Grid Grid.Row="2" Margin="20,30,20,20">
                <Button Content="Create Task" Command="{Binding CreateTaskCommand}" 
                        Classes="PrimaryButton" HorizontalAlignment="Center" Width="150"
                        Background="#DBE1E7" Foreground="#8997A5" FontWeight="SemiBold"
                        IsEnabled="{Binding TaskName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                 <!-- Note: Style needs to handle disabled state or we bind color manually differently if we want exact gray look from image when empty -->
            </Grid>
        </Grid>
    </Border>
</UserControl>
