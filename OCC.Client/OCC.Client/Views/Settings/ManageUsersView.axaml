<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.Settings"
             xmlns:conv="clr-namespace:OCC.Client.Converters"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="OCC.Client.Views.Settings.ManageUsersView"
             x:DataType="vm:ManageUsersViewModel">

    <UserControl.Resources>
        <conv:NameToInitialsConverter x:Key="NameToInitialsConverter"/>
        <conv:ActiveTabToBrushConverter x:Key="ActiveTabToBrushConverter"/>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto, Auto, *">
        <!-- Top Bar -->
        <Border Grid.Row="0" Background="White" BorderBrush="{DynamicResource BorderGray}" BorderThickness="0,0,0,1" Padding="20,0">
            <Grid ColumnDefinitions="Auto, *, Auto, Auto" Height="60">
                <!-- Tabs -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Grid.ColumnSpan="2" HorizontalAlignment="Center">
                     <Button Classes="Ghost" Command="{Binding SwitchTabCommand}" CommandParameter="Manage Users" 
                             BorderBrush="{Binding ActiveTab, Converter={StaticResource ActiveTabToBrushConverter}, ConverterParameter='Manage Users'}"
                             Padding="20,20">
                         <StackPanel Orientation="Horizontal" Spacing="8">
                             <PathIcon Data="{StaticResource IconUser}" Width="16" Height="16" Foreground="{DynamicResource TextPrimaryDark}"/>
                             <TextBlock Text="MANAGE USERS" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
                         </StackPanel>
                     </Button>

                     <Button Classes="Ghost" Command="{Binding SwitchTabCommand}" CommandParameter="Roles"
                             Padding="20,20">
                         <StackPanel Orientation="Horizontal" Spacing="8">
                             <PathIcon Data="{StaticResource IconRole}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                             <TextBlock Text="ROLES" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryGray}"/>
                         </StackPanel>
                     </Button>

                     <Button Classes="Ghost" Command="{Binding SwitchTabCommand}" CommandParameter="Holidays"
                             Padding="20,20">
                         <StackPanel Orientation="Horizontal" Spacing="8">
                             <PathIcon Data="{StaticResource IconCalendar}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                             <TextBlock Text="HOLIDAYS" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryGray}"/>
                         </StackPanel>
                     </Button>
                </StackPanel>                
            </Grid>
        </Border>

        <!-- Stats Bar -->
        <Border Grid.Row="1" Background="#F8F9FB" BorderBrush="{DynamicResource BorderGray}" BorderThickness="0,0,0,1" Padding="20,15">
            <Grid ColumnDefinitions="Auto, Auto, Auto, Auto, *, Auto">
                <Grid.Styles>
                    <Style Selector="StackPanel.Stat">
                        <Setter Property="Margin" Value="0,0,40,0"/>
                    </Style>
                    <Style Selector="TextBlock.StatLabel">
                        <Setter Property="FontSize" Value="10"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextSecondaryGray}"/>
                        <Setter Property="Margin" Value="0,0,0,5"/>
                    </Style>
                    <Style Selector="TextBlock.StatValue">
                        <Setter Property="FontSize" Value="18"/>
                        <Setter Property="FontWeight" Value="Medium"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryDark}"/>
                    </Style>
                </Grid.Styles>

                <StackPanel Classes="Stat" Grid.Column="0">
                    <TextBlock Text="TOTAL LICENSES" Classes="StatLabel"/>
                    <TextBlock Text="{Binding TotalLicenses}" Classes="StatValue"/>
                </StackPanel>

                <StackPanel Classes="Stat" Grid.Column="1">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                         <TextBlock Text="ALLOCATED" Classes="StatLabel"/>
                         <PathIcon Data="{StaticResource IconInfo}" Width="12" Height="12" Foreground="{DynamicResource TextSecondaryGray}" Margin="0,-2,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="{Binding AllocatedLicenses}" Classes="StatValue"/>
                        <Border Background="#E2E8F0" CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
                            <TextBlock Text="View" FontSize="10" Foreground="{DynamicResource TextSecondaryGray}"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <StackPanel Classes="Stat" Grid.Column="2">
                    <TextBlock Text="AVAILABLE" Classes="StatLabel"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="{Binding AvailableLicenses}" Classes="StatValue"/>
                         <Border Background="#E2E8F0" CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
                            <TextBlock Text="Invite" FontSize="10" Foreground="{DynamicResource TextSecondaryGray}"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <StackPanel Classes="Stat" Grid.Column="3">
                    <TextBlock Text="GUESTS" Classes="StatLabel"/>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="{Binding Guests}" Classes="StatValue"/>
                         <Border Background="#E2E8F0" CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
                            <TextBlock Text="View" FontSize="10" Foreground="{DynamicResource TextSecondaryGray}"/>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- Tools -->
                <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                    <Button Classes="Ghost" Command="{Binding InvitePeopleCommand}">
                         <StackPanel Orientation="Horizontal" Spacing="5">
                             <TextBlock Text="+" FontSize="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                             <TextBlock Text="Invite People" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center"/>
                         </StackPanel>
                    </Button>
                    
                    <PathIcon Data="{StaticResource IconSearch}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                    <PathIcon Data="{StaticResource IconSettings}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                    <PathIcon Data="{StaticResource IconFilter}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                    
                    <ComboBox SelectedIndex="0" Width="120" Background="White" BorderBrush="{DynamicResource BorderGray}">
                        <ComboBoxItem>Everyone</ComboBoxItem>
                        <ComboBoxItem>Guests</ComboBoxItem>
                        <ComboBoxItem>Admins</ComboBoxItem>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- User Grid -->
        <DataGrid Grid.Row="2" 
                  ItemsSource="{Binding Users}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  HeadersVisibility="Column"
                  GridLinesVisibility="Horizontal"
                  Background="White"
                  BorderThickness="0">
            <DataGrid.Styles>
                <Style Selector="DataGridColumnHeader">
                    <Setter Property="Foreground" Value="{DynamicResource TextSecondaryGray}"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="FontSize" Value="11"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Padding" Value="10,0"/>
                </Style>
                <Style Selector="DataGridRow">
                    <Setter Property="Height" Value="60"/>
                    <Setter Property="Background" Value="White"/>
                </Style>
            </DataGrid.Styles>

            <DataGrid.Columns>
                <!-- Avatar & Name -->
                <DataGridTemplateColumn Header="NAME" Width="2*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="15" Margin="20,0,0,0">
                                <Border Width="32" Height="32" CornerRadius="16" Background="{DynamicResource PrimaryTeal}" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding DisplayName, Converter={StaticResource NameToInitialsConverter}}" 
                                               Foreground="White" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center" FontWeight="Medium" Foreground="{DynamicResource TextPrimaryDark}"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Teams (Placeholder) -->
                <DataGridTextColumn Header="TEAMS" Binding="{Binding Id}" Width="*" Foreground="{DynamicResource TextSecondaryGray}"/>

                <!-- Role (Placeholder) -->
                <DataGridTextColumn Header="ROLE" Binding="{Binding Id}" Width="*" Foreground="{DynamicResource TextSecondaryGray}"/>

                <!-- Email -->
                <DataGridTextColumn Header="EMAIL" Binding="{Binding Email}" Width="2*" Foreground="{DynamicResource TextPrimaryDark}"/>

                <!-- Phone (Placeholder) -->
                <DataGridTextColumn Header="PHONE" Binding="{Binding Id}" Width="*" Foreground="{DynamicResource TextSecondaryGray}"/>

                <!-- Actions -->
                <DataGridTemplateColumn Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Classes="IconButton" Margin="0,0,20,0">
                                <PathIcon Data="{StaticResource IconMoreHorizontal}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
