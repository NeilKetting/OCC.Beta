<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:OCC.Client.ViewModels.Notifications;assembly=OCC.Client"
             xmlns:conv="using:OCC.Client.Converters"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="500"
             x:Class="OCC.Client.Views.Notifications.NotificationView"
             x:DataType="vm:NotificationViewModel">

    <UserControl.Resources>
        <conv:StringContainsConverter x:Key="StringContainsConverter"/>
    </UserControl.Resources>

    <Border Background="{DynamicResource AppBackgroundSlate}" 
            CornerRadius="12" 
            BoxShadow="0 0 10 5 #04d9ff" 
            BorderBrush="{DynamicResource BorderGray}" 
            BorderThickness="2" 
            Margin="10">
		<Grid RowDefinitions="Auto, *">
			<!-- Header -->
			<Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="20,15">
				<TextBlock Grid.Column="0" Text="Notifications" FontSize="16" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimary}"/>
                <Button Grid.Column="1" Classes="IconBtn" ToolTip.Tip="Clear All" Command="{Binding ClearNotificationCommand}" IsVisible="False">
                    <!-- TODO: Implement Clear All if needed -->
                    <PathIcon Data="{StaticResource delete_regular}" Foreground="{DynamicResource TextSecondaryGray}" Width="16" Height="16"/>
                </Button>
			</Grid>
            
            <Separator Grid.Row="0" VerticalAlignment="Bottom" Background="{DynamicResource BorderGray}"/>

			<!-- Content -->
			<Grid Grid.Row="1">
				
				<!-- Empty State -->
				<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="10" IsVisible="{Binding !HasNotifications}">
					<PathIcon Data="{StaticResource alert_regular}" Width="32" Height="32" Foreground="{DynamicResource TextSecondaryGray}" Opacity="0.5"/>
					<TextBlock Text="No new notifications" Foreground="{DynamicResource TextSecondaryGray}" HorizontalAlignment="Center" FontSize="14"/>
				</StackPanel>

				<!-- List -->
				<ScrollViewer IsVisible="{Binding HasNotifications}">
                    <ItemsControl ItemsSource="{Binding Notifications}" Margin="10">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="12" Margin="0,0,0,8" Background="{DynamicResource PageBackgroundBrush}" CornerRadius="8">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimary}" FontSize="13"/>
                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap" Foreground="{DynamicResource TextSecondaryGray}" FontSize="12"/>
                                            <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:g}'}" Foreground="{DynamicResource TextSecondaryGray}" FontSize="10" Opacity="0.7"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" Spacing="5" VerticalAlignment="Center" Margin="8,0,0,0">
                                            <Button Content="Approve"
                                                    Command="{Binding $parent[UserControl].((vm:NotificationViewModel)DataContext).ApproveUserCommand}"
                                                    CommandParameter="{Binding .}"
                                                    IsVisible="{Binding Title, Converter={StaticResource StringContainsConverter}, ConverterParameter='Approval'}"
                                                    Classes="Flat Small" Background="{DynamicResource PrimaryBrush}" Foreground="White"/>
                                            
                                            <Button Classes="IconBtn" 
                                                    Command="{Binding $parent[UserControl].((vm:NotificationViewModel)DataContext).ClearNotificationCommand}"
                                                    CommandParameter="{Binding .}"
                                                    ToolTip.Tip="Dismiss">
                                                <PathIcon Data="{StaticResource dismiss_regular}" Width="12" Height="12" Foreground="{DynamicResource TextSecondaryGray}"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
			</Grid>
		</Grid>
	</Border>
	
</UserControl>
