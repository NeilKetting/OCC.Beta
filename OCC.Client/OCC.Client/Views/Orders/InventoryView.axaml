<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="using:OCC.Client.ViewModels.Orders"
			 xmlns:models="using:OCC.Shared.Models"
			 xmlns:views="using:OCC.Client.Views.Orders"
			 xmlns:i="clr-namespace:Avalonia.Xaml.Interactivity;assembly=Avalonia.Xaml.Interactivity"
			 xmlns:ia="clr-namespace:Avalonia.Xaml.Interactions.Core;assembly=Avalonia.Xaml.Interactions"
			 mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="800"
			 xmlns:conv="clr-namespace:OCC.Client.Converters"
			 x:Class="OCC.Client.Views.Orders.InventoryView"
			 x:DataType="vm:InventoryViewModel">

	<UserControl.Resources>
		<conv:StatusColorConverter x:Key="StatusColorConverter" />
	</UserControl.Resources>



	<Grid RowDefinitions="Auto, *" Margin="5">
		<!-- Header / Tools -->
		<Border Grid.Row="0" Margin="0,0,0,10" Classes="TopHeader" Background="{DynamicResource WeatheredCementGradient}">
			<Grid ColumnDefinitions="Auto, *, Auto">
				<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="20">
					<StackPanel Spacing="5">
						<TextBlock Text="Inventory List" FontSize="{StaticResource FontSizeLarge}" FontWeight="Bold"/>
						<TextBlock Text="Master list of all inventory items. Double-click to edit." Foreground="#94A3B8" FontSize="{StaticResource FontsizeMedium}"/>
					</StackPanel>
				</StackPanel>

				<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
					<TextBox Width="250" Text="{Binding SearchQuery}" Watermark="Search Product..." Classes="SearchBox"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Grid -->
		<DataGrid Grid.Row="1" ItemsSource="{Binding InventoryItems}"
				  AutoGenerateColumns="False"
				  IsReadOnly="True"
				  HeadersVisibility="Column"
				  GridLinesVisibility="Horizontal"
				  Background="White"
				  BorderThickness="0"
				  SelectedItem="{Binding SelectedInventoryItem}">

			<Interaction.Behaviors>
				<EventTriggerBehavior EventName="DoubleTapped">
					<InvokeCommandAction Command="{Binding EditInventoryItemCommand}" CommandParameter="{Binding SelectedInventoryItem}"/>
				</EventTriggerBehavior>
			</Interaction.Behaviors>

			<Interaction.Behaviors>
				<EventTriggerBehavior EventName="DoubleTapped">
					<InvokeCommandAction Command="{Binding EditInventoryItemCommand}" CommandParameter="{Binding SelectedInventoryItem}"/>
				</EventTriggerBehavior>
			</Interaction.Behaviors>

			<DataGrid.Styles>
				<Style Selector="DataGridRow" x:DataType="models:InventoryItem">
					<Setter Property="ContextMenu">
						<ContextMenu>
							<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:InventoryViewModel)DataContext).EditInventoryItemCommand}" CommandParameter="{Binding .}"/>
							<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:InventoryViewModel)DataContext).DeleteInventoryItemCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
						</ContextMenu>
					</Setter>
				</Style>
			</DataGrid.Styles>

			<DataGrid.Columns>
				<DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="Auto" FontWeight="SemiBold" Foreground="{DynamicResource TextSecondaryGray}"/>
				<DataGridTextColumn Header="PRODUCT" Binding="{Binding ProductName}" Width="Auto" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryDark}"/>
				<DataGridTextColumn Header="CATEGORY" Binding="{Binding Category}" Width="Auto" Foreground="{DynamicResource TextSecondaryDark}"/>
				<DataGridTextColumn Header="LOCATION" Binding="{Binding Location}" Width="Auto" Foreground="{DynamicResource TextSecondaryDark}"/>
				<DataGridTextColumn Header="ON HAND" Binding="{Binding QuantityOnHand}" Width="Auto" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}"/>
				<DataGridTextColumn Header="UNIT" Binding="{Binding UnitOfMeasure}" Width="Auto" Foreground="{DynamicResource TextSecondaryDark}"/>

				<DataGridTemplateColumn Header="STATUS" Width="Auto">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Border CornerRadius="4" Padding="8,2" VerticalAlignment="Center" HorizontalAlignment="Left"
									Background="{Binding InventoryStatus, Converter={StaticResource StatusColorConverter}, ConverterParameter=Background}">
								<TextBlock Text="{Binding InventoryStatus}"
										   FontSize="11" FontWeight="SemiBold"
										   Foreground="{Binding InventoryStatus, Converter={StaticResource StatusColorConverter}, ConverterParameter=Foreground}"/>
							</Border>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>

				<!-- Actions -->
				<DataGridTemplateColumn Header="ACTIONS" Width="Auto">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Button Classes="IconButton" Margin="0,0,20,0">
								<Button.Flyout>
									<MenuFlyout Placement="BottomEdgeAlignedRight">
										<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:InventoryViewModel)DataContext).EditInventoryItemCommand}" CommandParameter="{Binding .}"/>
										<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:InventoryViewModel)DataContext).DeleteInventoryItemCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
									</MenuFlyout>
								</Button.Flyout>
								<PathIcon Data="{StaticResource IconMoreHorizontal}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
							</Button>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Loading -->
		<StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding IsBusy}">
			<ProgressBar IsIndeterminate="True" Width="200" Foreground="{DynamicResource OCCOrange}"/>
			<TextBlock Text="{Binding BusyText}" HorizontalAlignment="Center" Margin="0,10,0,0" Classes="LabelSmall"/>
		</StackPanel>

		<!-- Empty State -->
		<StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center"
					IsVisible="{Binding !InventoryItems.Count}">
			<TextBlock Text="No items found." IsVisible="{Binding !IsBusy}" Classes="LabelSmall"/>
		</StackPanel>

		<!-- Popup Overlay -->
		<Grid Grid.Row="0" Grid.RowSpan="2" Background="#80000000" IsVisible="{Binding IsDetailVisible, FallbackValue=false}">
			<Grid Background="#50000000"> <!-- Extra click shield -->
			<views:ItemDetailView DataContext="{Binding DetailViewModel}"
								  HorizontalAlignment="Center"
								  VerticalAlignment="Center"/>
			</Grid>
		</Grid>
	</Grid>
</UserControl>
