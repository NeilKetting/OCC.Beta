<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="clr-namespace:OCC.Client.ViewModels.Customers"
			 xmlns:models="using:OCC.Shared.Models"
			 mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
			 x:Class="OCC.Client.Views.Customers.CustomerListView"
			 x:DataType="vm:CustomerManagementViewModel">

	<Grid RowDefinitions="Auto, Auto, *">
		<!-- Header -->
		<Border Grid.Row="0" Classes="TopHeader" Background="{DynamicResource WeatheredCementGradient}" Margin="5">
			<Grid ColumnDefinitions="*, Auto">
				<StackPanel Spacing="5">
					<TextBlock Text="Customer Overview" FontSize="{StaticResource FontSizeLarge}" FontWeight="Bold" />
					<TextBlock Text="Manage clients and customer records." Foreground="#94A3B8" FontSize="{StaticResource FontsizeMedium}" />
				</StackPanel>

				<Button Grid.Column="1" Command="{Binding AddCustomerCommand}" Classes="Primary" Padding="15,8" VerticalAlignment="Center">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<PathIcon Data="{StaticResource IconAddUser}" Width="16" Height="16"/>
						<TextBlock Text="Add Customer" VerticalAlignment="Center" FontWeight="SemiBold"/>
					</StackPanel>
				</Button>
			</Grid>
		</Border>

		<!-- Toolbar -->
		<Border Grid.Row="1" Classes="TopHeader" Background="{DynamicResource WeatheredCementGradient}" Margin="5,0,5,5" Padding="10,5">
			<Grid ColumnDefinitions="Auto, *, Auto">
				<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
					<TextBox Width="250" Watermark="Search customers..." 
							 Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" 
							 Background="White" BorderBrush="{DynamicResource BorderGray}" VerticalContentAlignment="Center">
						<TextBox.InnerRightContent>
							<PathIcon Data="{StaticResource IconSearch}" Width="14" Height="14" Margin="0,0,10,0" Foreground="{DynamicResource TextTertiarySlate}"/>
						</TextBox.InnerRightContent>
					</TextBox>
				</StackPanel>

				<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
					<TextBlock Text="TOTAL:" FontSize="10" FontWeight="Bold" Foreground="#64748B" VerticalAlignment="Center"/>
					<TextBlock Text="{Binding TotalCount}" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Grid -->
		<DataGrid Grid.Row="2"
				  ItemsSource="{Binding Customers}"
				  SelectedItem="{Binding SelectedCustomer}"
				  AutoGenerateColumns="False"
				  IsReadOnly="True"
				  HeadersVisibility="Column"
				  GridLinesVisibility="Horizontal"
				  Background="White"
				  BorderThickness="0"
                  DoubleTapped="DataGrid_DoubleTapped">
			<DataGrid.Styles>
				<Style Selector="DataGridRow" x:DataType="models:Customer">
					<Setter Property="ContextMenu">
						<ContextMenu>
							<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:CustomerManagementViewModel)DataContext).EditCustomerCommand}" CommandParameter="{Binding .}"/>
							<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:CustomerManagementViewModel)DataContext).DeleteCustomerCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
						</ContextMenu>
					</Setter>
				</Style>
			</DataGrid.Styles>

			<DataGrid.Columns>
				<DataGridTextColumn Header="CUSTOMER NAME" Binding="{Binding Name}" Width="2*" Foreground="{DynamicResource TextPrimaryDark}"/>
				<DataGridTextColumn Header="HEADER" Binding="{Binding Header}" Width="*" Foreground="{DynamicResource TextSecondaryGray}"/>
				<DataGridTextColumn Header="EMAIL" Binding="{Binding Email}" Width="1.5*" Foreground="{DynamicResource TextSecondaryGray}"/>
				<DataGridTextColumn Header="PHONE" Binding="{Binding Phone}" Width="*" Foreground="{DynamicResource TextSecondaryGray}"/>
                
				<!-- Actions -->
				<DataGridTemplateColumn Width="Auto">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Button Classes="IconButton" Margin="0,0,20,0">
								<Button.Flyout>
									<MenuFlyout Placement="BottomEdgeAlignedRight">
										<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:CustomerManagementViewModel)DataContext).EditCustomerCommand}" CommandParameter="{Binding .}"/>
										<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:CustomerManagementViewModel)DataContext).DeleteCustomerCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
									</MenuFlyout>
								</Button.Flyout>
								<PathIcon Data="{StaticResource IconMoreHorizontal}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
							</Button>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Loading -->
		<StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding IsBusy}">
			<ProgressBar IsIndeterminate="True" Width="200" Foreground="{DynamicResource Orange}"/>
			<TextBlock Text="{Binding BusyText}" HorizontalAlignment="Center" Margin="0,10,0,0" Classes="LabelSmall"/>
		</StackPanel>

		<!-- Empty State -->
		<StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center"
					IsVisible="{Binding !Customers.Count}">
			<TextBlock Text="No customers found." IsVisible="{Binding !IsBusy}" Classes="LabelSmall"/>
		</StackPanel>
	</Grid>
</UserControl>
