<Styles xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:controls="clr-namespace:OCC.Client.Controls">

	<Design.PreviewWith>
		<StackPanel>
			<Border Padding="20">
				<controls:SearchableComboBox Width="250" Watermark="Search items..." />
			</Border>

			<Border Padding="20">
				<controls:SearchableComboBox Width="250" Watermark="Search items..." />
			</Border>
		</StackPanel>
	</Design.PreviewWith>

	<Style Selector="controls|SearchableComboBox">
		<Setter Property="VerticalAlignment" Value="Center" />
		<Setter Property="MinHeight" Value="32" />
		<Setter Property="Padding" Value="0" />
		<Setter Property="BorderThickness" Value="2" />
		<Setter Property="BorderBrush" Value="#CCCCCC" />
		<Setter Property="Background" Value="White" />
		<Setter Property="MinimumPrefixLength" Value="0" />
		<Setter Property="Template">
			<ControlTemplate>
					<Grid ColumnDefinitions="*, Auto">
						<Border Name="PART_BorderElement"
								Grid.ColumnSpan="2"
								Background="{TemplateBinding Background}"
								BorderBrush="{TemplateBinding BorderBrush}"
								BorderThickness="{TemplateBinding BorderThickness}"
								CornerRadius="4">
							
							<Grid ColumnDefinitions="*, Auto">
								<TextBox Name="PART_TextBox"
										 Grid.Column="0"
										 Padding="5,0"
										 Watermark="{TemplateBinding Watermark}"
										 BorderThickness="0"
										 Background="Transparent"
										 FocusAdorner="{x:Null}"
										 VerticalContentAlignment="Center"
										 MinHeight="0"
										 FontSize="12" />

								<!-- Button with Left Border as Separator -->
								<Button Name="PART_ToggleButton"
										Grid.Column="1"
										Width="30"
										VerticalAlignment="Stretch"
										Background="#F0F0F0"
										BorderBrush="{TemplateBinding BorderBrush}"
										BorderThickness="1,0,0,0"
										CornerRadius="0,4,4,0"
										Padding="0"
										ZIndex="5"
										MinHeight="0"
										ClickMode="Press"
										IsVisible="{TemplateBinding IsDropdownButtonVisible}"
										Focusable="False"
										Cursor="Hand">
									<PathIcon Data="{StaticResource IconChevronDown}"
											  Width="12"
											  Height="12"
											  IsHitTestVisible="False"
											  Foreground="{DynamicResource TextSecondaryGray}" />
								</Button>
							</Grid>
						</Border>

					<Popup Name="PART_Popup"
						   WindowManagerAddShadowHint="True"
						   IsLightDismissEnabled="True"
						   IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
						   PlacementTarget="{Binding ElementName=PART_BorderElement}"
						   MinWidth="{Binding Bounds.Width, ElementName=PART_BorderElement}">
						<Border Name="PART_SuggestionsContainer"
								Background="White"
								BorderBrush="{DynamicResource ThemeBorderMid}"
								BorderThickness="1"
								CornerRadius="4"
								Margin="0,4,0,4"
								BoxShadow="0 4 12 0 #20000000">
							<Grid RowDefinitions="Auto, *">
								<!-- Add New Section -->
								<Button Name="PART_AddNewButton"
										Grid.Row="0"
										HorizontalAlignment="Stretch"
										HorizontalContentAlignment="Left"
										Padding="12,8"
										Background="Transparent"
										Foreground="{DynamicResource PrimaryTeal}"
										Command="{TemplateBinding AddNewCommand}"
										Focusable="False"
										IsVisible="{Binding !!AddNewCommand, RelativeSource={RelativeSource TemplatedParent}}">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<PathIcon Data="{StaticResource IconPlus}" Width="10" Height="10" />
										<StackPanel Orientation="Horizontal" Spacing="4">
											<TextBlock Text="{TemplateBinding AddNewLabel}" FontSize="12" />
											<TextBlock Text="{Binding Text, ElementName=PART_TextBox}"
													   FontSize="12"
													   FontWeight="SemiBold"
													   TextTrimming="CharacterEllipsis"
													   MaxWidth="200"/>
										</StackPanel>
									</StackPanel>
								</Button>

								<ListBox Name="PART_SelectingItemsControl"
										 Grid.Row="1"
										 BorderThickness="0"
										 Background="Transparent"
										 ItemTemplate="{TemplateBinding ItemTemplate}"
										 Padding="0,0,0,0"
										 Focusable="False"
										 MaxHeight="300">
									<ListBox.Styles>
										<Style Selector="ListBoxItem">
											<Setter Property="Padding" Value="12,6" />
											<Setter Property="FontSize" Value="12" />
											<Setter Property="Focusable" Value="False" />
										</Style>
									</ListBox.Styles>
								</ListBox>
							</Grid>
						</Border>
					</Popup>
				</Grid>
			</ControlTemplate>
		</Setter>
	</Style>

	<!-- PointerOver State -->
	<Style Selector="controls|SearchableComboBox:pointerover">
		<Setter Property="BorderBrush" Value="{DynamicResource PrimaryTeal}" />
	</Style>

	<!-- Focused State -->
	<Style Selector="controls|SearchableComboBox:focus-within">
		<Setter Property="BorderBrush" Value="{DynamicResource PrimaryTeal}" />
		<Setter Property="BorderThickness" Value="2" />
	</Style>

	<!-- Custom Button Styles to maintain separator and ensure hover doesn't break layout -->
	<Style Selector="controls|SearchableComboBox:pointerover /template/ Button#PART_ToggleButton">
		<Setter Property="BorderBrush" Value="{DynamicResource PrimaryTeal}" />
	</Style>
	
	<Style Selector="controls|SearchableComboBox /template/ Button#PART_ToggleButton:pointerover /template/ ContentPresenter">
		<Setter Property="Background" Value="#E0E0E0" />
		<Setter Property="BorderThickness" Value="1,0,0,0" />
		<Setter Property="BorderBrush" Value="{DynamicResource PrimaryTeal}" />
	</Style>
	
	<Style Selector="controls|SearchableComboBox /template/ Button#PART_ToggleButton:pressed /template/ ContentPresenter">
		<Setter Property="Background" Value="#D0D0D0" />
		<Setter Property="BorderThickness" Value="1,0,0,0" />
	</Style>

	<!-- Fix TextBox hover/focus states to prevent overlay -->
	<Style Selector="controls|SearchableComboBox /template/ TextBox#PART_TextBox">
		<Setter Property="FocusAdorner" Value="{x:Null}" />
	</Style>
	<Style Selector="controls|SearchableComboBox /template/ TextBox#PART_TextBox:pointerover">
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="BorderBrush" Value="Transparent" />
	</Style>
	<Style Selector="controls|SearchableComboBox /template/ TextBox#PART_TextBox:focus">
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="BorderThickness" Value="0" />
	</Style>

	<!-- Deep selector to override the TextBox's internal border style on focus -->
	<Style Selector="controls|SearchableComboBox /template/ TextBox#PART_TextBox:focus /template/ Border#PART_BorderElement">
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="BorderThickness" Value="0" />
	</Style>

	<!-- Deep selector to override the TextBox's internal border style on pointerover (hover) -->
	<Style Selector="controls|SearchableComboBox /template/ TextBox#PART_TextBox:pointerover /template/ Border#PART_BorderElement">
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="BorderThickness" Value="0" />
	</Style>

	<!-- DataGrid Integration Style -->
	<Style Selector="controls|SearchableComboBox.DataGrid">
		<Setter Property="MinHeight" Value="0" />
		<Setter Property="Height" Value="30" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="Padding" Value="0" />
	</Style>

	<Style Selector="controls|SearchableComboBox.DataGrid:pointerover /template/ Border#PART_BorderElement,
				   controls|SearchableComboBox.DataGrid:focus /template/ Border#PART_BorderElement,
				   controls|SearchableComboBox.DataGrid:focus-within /template/ Border#PART_BorderElement">
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="Background" Value="White" />
	</Style>

	<Style Selector="controls|SearchableComboBox.DataGrid /template/ TextBox#PART_TextBox">
		<Setter Property="Padding" Value="4,0" />
		<Setter Property="FontSize" Value="11" />
	</Style>

	<Style Selector="controls|SearchableComboBox.DataGrid /template/ Button#PART_ToggleButton">
		<Setter Property="Width" Value="24" />
		<Setter Property="Background" Value="#F5F5F5" />
		<Setter Property="BorderThickness" Value="0" />
	</Style>

	<!-- Shared DataGrid Input Style (TextBox, NumericUpDown, etc.) -->
	<Style Selector="TextBox.DataGrid">
		<Setter Property="MinHeight" Value="0" />
		<Setter Property="Height" Value="30" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="Padding" Value="4,0" />
		<Setter Property="FontSize" Value="11" />
		<Setter Property="VerticalContentAlignment" Value="Center" />
		<Setter Property="VerticalAlignment" Value="Center" />
	</Style>

	<Style Selector="NumericUpDown.DataGrid">
		<Setter Property="MinHeight" Value="0" />
		<Setter Property="Height" Value="30" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="Padding" Value="4,0" />
		<Setter Property="FontSize" Value="11" />
		<Setter Property="VerticalContentAlignment" Value="Center" />
		<Setter Property="VerticalAlignment" Value="Center" />
	</Style>

	<Style Selector="TextBox.DataGrid:pointerover /template/ Border#PART_BorderElement,
				   TextBox.DataGrid:focus /template/ Border#PART_BorderElement">
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="Background" Value="White" />
	</Style>

	<Style Selector="NumericUpDown.DataGrid:pointerover /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid:focus /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid:focus-within /template/ Border#PART_BorderElement">
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="Background" Value="White" />
	</Style>

	<!-- Safer suppression for internal elements inside NumericUpDown -->
	<Style Selector="NumericUpDown.DataGrid /template/ TextBox">
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
		<Setter Property="Background" Value="Transparent" />
	</Style>

	<!-- Button version for DataGrid (e.g. UOM) -->
	<Style Selector="Button.DataGrid">
		<Setter Property="MinHeight" Value="28" />
		<Setter Property="Background" Value="Transparent" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="Padding" Value="5,0" />
		<Setter Property="FontSize" Value="11" />
		<Setter Property="CornerRadius" Value="0" />
		<Setter Property="FocusAdorner" Value="{x:Null}" />
		<Setter Property="VerticalContentAlignment" Value="Center" />
		<Setter Property="VerticalAlignment" Value="Center" />
	</Style>

	<Style Selector="Button.DataGrid:pointerover /template/ ContentPresenter">
		<Setter Property="Background" Value="White" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
	</Style>

	<Style Selector="Button.DataGrid:focus /template/ ContentPresenter">
		<Setter Property="Background" Value="White" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
	</Style>

	<Style Selector="Button.DataGrid:pressed /template/ ContentPresenter">
		<Setter Property="Background" Value="White" />
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
	</Style>
	<!-- Error State: Remove default double-border adorner and use BorderBrush -->
	<Style Selector="controls|SearchableComboBox:error">
		<Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextForegroundBrush}" />
		<Setter Property="DataValidationErrors.ErrorTemplate" Value="{x:Null}" />
	</Style>

	<!-- Aggressive Border Removal for DataGrid Inputs -->
	<Style Selector="TextBox.DataGrid /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid /template/ TextBox /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid:pointerover /template/ TextBox /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid:focus /template/ TextBox /template/ Border#PART_BorderElement,
				   NumericUpDown.DataGrid:focus-within /template/ TextBox /template/ Border#PART_BorderElement">
		<Setter Property="BorderThickness" Value="0" />
		<Setter Property="BorderBrush" Value="Transparent" />
	</Style>

</Styles>
