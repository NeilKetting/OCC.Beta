<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="clr-namespace:OCC.Client.Features.EmployeeHub.ViewModels"
			 xmlns:models="using:OCC.Shared.Models"
			 xmlns:dtos="using:OCC.Shared.DTOs"
			 xmlns:views="clr-namespace:OCC.Client.Features.EmployeeHub.Views"
			 xmlns:conv="clr-namespace:OCC.Client.Converters"
			 mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
			 x:Class="OCC.Client.Features.EmployeeHub.Views.EmployeeListView"
			 x:DataType="vm:EmployeeManagementViewModel">

	<Grid RowDefinitions="Auto, *">
		<!-- Header Bar: Title & Primary Actions -->
		<Border Grid.Row="0" Classes="TopHeader" Margin="2" Background="{DynamicResource MainPageGradient}">		
			<Grid RowDefinitions="Auto, Auto">
				<Grid Grid.Row="0" ColumnDefinitions="*, Auto">
					<!-- Title -->
					<StackPanel Spacing="5">
						<TextBlock Text="Employee Overview" 
								   FontSize="{StaticResource FontSizeLarge}" 
								   FontWeight="Bold" />
						<TextBlock Text="Manage staff records, positions and teams." 
								   Foreground="#64748B" 
								   FontSize="{StaticResource FontsizeMedium}" />
					</StackPanel>

					<!-- Action Buttons -->
					<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
						<Button Command="{Binding AddEmployeeCommand}" Classes="Primary" Padding="15,8">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<PathIcon Data="{StaticResource IconAddUser}" Width="16" Height="16"/>
								<TextBlock Text="Add Employee" VerticalAlignment="Center" FontWeight="SemiBold"/>
							</StackPanel>
						</Button>
						<Button Command="{Binding ImportEmployeesCommand}" Classes="Secondary" Padding="15,8" ToolTip.Tip="Import from CSV" IsVisible="{Binding CanImportExport}">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<PathIcon Data="{StaticResource IconUpload}" Width="16" Height="16"/>
								<TextBlock Text="Import Data" VerticalAlignment="Center" FontWeight="SemiBold"/>
							</StackPanel>
						</Button>
						<Button Command="{Binding ExportEmployeesCommand}" Classes="Secondary" Padding="15,8" ToolTip.Tip="Export to JSON" IsVisible="{Binding CanImportExport}">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<PathIcon Data="{StaticResource IconExportData}" Width="16" Height="16"/>
								<TextBlock Text="Export Data" VerticalAlignment="Center" FontWeight="SemiBold"/>
							</StackPanel>
						</Button>
					</StackPanel>
				</Grid>
				<!-- Filters -->
				<Grid Grid.Row="1" ColumnDefinitions="Auto, *, Auto" Margin="0,10,0,0">

					<StackPanel Grid.Column="0" Orientation="Horizontal"
								Spacing="15" VerticalAlignment="Bottom">

						<StackPanel Spacing="2" VerticalAlignment="Bottom">
							<TextBlock Text="Search" Classes="LabelSmall" FontSize="10" 
									   Foreground="#64748B"/>
							<TextBox Width="200" Watermark="Search employees..."
									 Text="{Binding SearchQuery,
									 UpdateSourceTrigger=PropertyChanged}"
									 Background="White"
									 BorderBrush="{DynamicResource BorderGray}"
									 VerticalContentAlignment="Center"
									 VerticalAlignment="Bottom">
								<TextBox.InnerRightContent>
									<PathIcon Data="{StaticResource IconSearch}" Width="14" Height="14" Margin="0,0,10,0" Foreground="{DynamicResource TextTertiarySlate}"/>
								</TextBox.InnerRightContent>
							</TextBox>
						</StackPanel>


						<!-- Employemtn Type -->
						<StackPanel Spacing="2" VerticalAlignment="Bottom">
							<TextBlock Text="Employment Type" Classes="LabelSmall" FontSize="10" 
									   Foreground="#64748B"/>
							<ComboBox SelectedIndex="{Binding SelectedFilterIndex}" Width="130" Background="White" BorderBrush="{DynamicResource BorderGray}">
								<ComboBoxItem>Everyone</ComboBoxItem>
								<ComboBoxItem>Permanent</ComboBoxItem>
								<ComboBoxItem>Contract</ComboBoxItem>
							</ComboBox>
						</StackPanel>

						<!-- Branch -->
						<StackPanel Spacing="2" VerticalAlignment="Bottom">
							<TextBlock Text="Branch" Classes="LabelSmall" FontSize="10" 
									   Foreground="#64748B"/>
							<ComboBox SelectedIndex="{Binding SelectedBranchFilterIndex}" Width="150" Background="White" BorderBrush="{DynamicResource BorderGray}">
								<ComboBoxItem>All Branches</ComboBoxItem>
								<ComboBoxItem>Johannesburg</ComboBoxItem>
								<ComboBoxItem>Cape Town</ComboBoxItem>
							</ComboBox>
						</StackPanel>
					</StackPanel>

					<!-- Summary Stats -->
					<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="25" VerticalAlignment="Center">
						<StackPanel Orientation="Vertical" Spacing="8">
							<TextBlock Text="TOTAL:" FontSize="10" FontWeight="Bold" Foreground="#64748B" VerticalAlignment="Center" HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding TotalCount}" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
						</StackPanel>

						<StackPanel Orientation="Vertical" Spacing="8">
							<TextBlock Text="PERMANENT:" FontSize="10" FontWeight="Bold" Foreground="#64748B" VerticalAlignment="Center" HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding PermanentCount}" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
						</StackPanel>

						<StackPanel Orientation="Vertical" Spacing="8">
							<TextBlock Text="CONTRACT:" FontSize="10" FontWeight="Bold" Foreground="#64748B" VerticalAlignment="Center" HorizontalAlignment="Center"/>
							<TextBlock Text="{Binding ContractCount}" FontSize="14" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryDark}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
						</StackPanel>
					</StackPanel>
				</Grid>
			</Grid>
		</Border>

		<!-- Employee Grid -->
		<DataGrid Grid.Row="1"
				  ItemsSource="{Binding Employees}"
				  SelectedItem="{Binding SelectedEmployee}"
				  AutoGenerateColumns="False"
				  IsReadOnly="True"
				  HeadersVisibility="Column"
				  GridLinesVisibility="Horizontal"
				  Background="White"
				  BorderThickness="0"
				  DoubleTapped="DataGrid_DoubleTapped">
			<DataGrid.Styles>
				<Style Selector="DataGridRow" x:DataType="dtos:EmployeeSummaryDto">
					<Setter Property="ContextMenu">
						<ContextMenu>
							<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:EmployeeManagementViewModel)DataContext).EditEmployeeCommand}" CommandParameter="{Binding .}"/>
							<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:EmployeeManagementViewModel)DataContext).DeleteEmployeeCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
						</ContextMenu>
					</Setter>
				</Style>
			</DataGrid.Styles>

			<DataGrid.Columns>
				<!-- Employee Number -->
				<DataGridTextColumn Header="EMPLOYEE NUMBER" Binding="{Binding EmployeeNumber}" Width="Auto" Foreground="{DynamicResource TextPrimaryDark}"/>

				<!-- Name -->
				<DataGridTextColumn Header="EMPLOYEE" Binding="{Binding DisplayName, Converter={x:Static conv:StringToTitleCaseConverter.Instance}, Mode=OneWay}" Width="*" MinWidth="250" Foreground="{DynamicResource TextPrimaryDark}"/>

				<!-- Skill / Role -->
				<DataGridTextColumn Header="SKILL" Binding="{Binding Role}" Width="Auto" Foreground="{DynamicResource TextSecondaryGray}"/>


				<!-- Contract or Permanent -->
				<DataGridTextColumn Header="EMPLOYMENT TYPE" Binding="{Binding EmploymentType}" Width="2*" Foreground="{DynamicResource TextPrimaryDark}"/>

				<!-- Actions -->
				<DataGridTemplateColumn Width="Auto">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Button Classes="IconButton" Margin="0,0,20,0">
								<Button.Flyout>
									<MenuFlyout Placement="BottomEdgeAlignedRight">
										<MenuItem Header="Edit" Command="{Binding $parent[UserControl].((vm:EmployeeManagementViewModel)DataContext).EditEmployeeCommand}" CommandParameter="{Binding .}"/>
										<MenuItem Header="Delete" Command="{Binding $parent[UserControl].((vm:EmployeeManagementViewModel)DataContext).DeleteEmployeeCommand}" CommandParameter="{Binding .}" Foreground="Red"/>
									</MenuFlyout>
								</Button.Flyout>
								<PathIcon Data="{StaticResource IconMoreHorizontal}" Width="16" Height="16" Foreground="{DynamicResource TextSecondaryGray}"/>
							</Button>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Error Message -->
		<TextBlock Grid.Row="2" Text="{Binding ErrorMessage}" Foreground="Red" Margin="0,5,0,5"
				   IsVisible="{Binding !!ErrorMessage}" TextWrapping="Wrap" HorizontalAlignment="Center"/>

		<!-- Loading -->
		<StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding IsBusy}">
			<ProgressBar IsIndeterminate="True" Width="200" Foreground="{DynamicResource Orange}"/>
			<TextBlock Text="{Binding BusyText}" HorizontalAlignment="Center" Margin="0,10,0,0" Classes="LabelSmall"/>
		</StackPanel>

		<!-- Empty State -->
		<StackPanel Grid.Row="2" VerticalAlignment="Center" HorizontalAlignment="Center"
					IsVisible="{Binding !Employees.Count}">
			<TextBlock Text="No employees found." IsVisible="{Binding !IsBusy}" Classes="LabelSmall"/>
		</StackPanel>
	</Grid>
</UserControl>
